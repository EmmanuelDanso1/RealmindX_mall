<div class="mt-4">
  <h5>Ratings</h5>

  <!--  Show average rating -->
  {% if product.ratings %}
    {% set avg_rating = (product.ratings | map(attribute='rating') | list | sum) / product.ratings|length %}
    <p class="text-warning">
      {% for i in range(1, 6) %}
        {% if i <= avg_rating %}
          <span>&#9733;</span>
        {% else %}
          <span class="text-secondary">&#9733;</span>
        {% endif %}
      {% endfor %}
      <small>({{ '%.1f' % avg_rating }} / 5 based on {{ product.ratings|length }} reviews)</small>
    </p>
  {% else %}
    <p class="text-muted">No ratings yet</p>
  {% endif %}

  <!-- ⭐ Rating submission -->
  {% if current_user.is_authenticated %}
    {% if user_rating %}
      <p class="text-muted">You rated this product: ⭐ {{ user_rating.rating }}/5</p>
    {% else %}
      <form method="POST" action="{{ url_for('main.rate_product', product_id=product.id) }}">
        <div class="rating mb-2">
          {% for i in range(5, 0, -1) %}
            <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}">
            <label for="star{{ i }}">&#9733;</label>
          {% endfor %}
        </div>
        <button type="submit" class="btn btn-sm btn-primary">Submit</button>
      </form>
    {% endif %}
  {% else %}
    <p><a href="{{ url_for('auth.login') }}">Log in</a> to rate this product.</p>
  {% endif %}
</div>
