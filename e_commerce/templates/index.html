<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}RealmindX Bookshop{% endblock %}</title>
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='images/brain.png') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    .offcanvas-half {
      width: 50% !important;
      max-width: 300px;
    }
    .offcanvas-body a {
      text-decoration: none;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-3">
  <div class="container-fluid">

    <!-- Hamburger for small/medium -->
    <button class="btn d-lg-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu">
      <i class="fas fa-bars fa-lg" style="color: #0C2E60;"></i>
    </button>

    <!-- Brand (Logo) -->
    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.shop') }}">
      <img src="{{ url_for('static', filename='images/17.png') }}" 
          alt="RealmindX Bookshop Logo" 
          style="height: 55px; width: auto;">
    </a>

    <!-- Cart icon small/medium -->
    <a href="{{ url_for('cart.view_cart') }}" class="text-dark position-relative ms-2 d-lg-none">
      <i class="fas fa-shopping-cart"></i>
      {% if cart_item_count %}
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ cart_item_count }}
      </span>
      {% endif %}
    </a>

    <!-- Mobile search -->
    <form method="GET" action="{{ url_for('main.search') }}" class="d-flex d-lg-none w-100 mt-3">
      <input class="form-control me-2 rounded-pill" type="search" name="q"  placeholder="Search for products, author..." autocomplete="off">
      <select name="category" class="form-select me-2 rounded-pill">
        <option value="">All</option>
        {% for cat in categories %}
        <option value="{{ cat.id }}">{{ cat.name }}</option>
        {% endfor %}
      </select>
      <button class="btn rounded-pill" style="background-color: #143670; color:#fff"><i class="fas fa-search"></i></button>
    </form>

    <!-- Large screen search + links -->
    <div class="collapse navbar-collapse d-none d-lg-flex justify-content-between mt-2">
      <div class="d-flex align-items-center w-100">
        <form method="GET" action="{{ url_for('main.search') }}" class="d-flex w-50 me-3">
          <input class="form-control me-2 rounded-pill" type="search" name="q" placeholder="Search for products, author, level..." autocomplete="off">
          <select name="category" class="form-select me-2 rounded-pill">
            <option value="">All Categories</option>
            {% for cat in categories %}
              <option value="{{ cat.id }}">
                {% if cat.name|length in [3, 5] %}
                  {{ cat.name.upper() }}
                {% else %}
                  {{ cat.name }}
                {% endif %}
              </option>
            {% endfor %}
          </select>
          <button class="btn text-white rounded-pill" style="background-color: #143670;"><i class="fas fa-search"></i></button>
        </form>

        <!-- Right Nav Links -->
        <div class="d-flex align-items-center ms-auto">
          <a href="{{ url_for('main.contact') }}" class="btn btn-outline-dark me-3 rounded-pill"><i></i>Contact</a>
          <a href="{{ url_for('main.track_order') }}" class="btn btn-outline-dark me-3 rounded-pill"><i></i>Track your order</a>
          <a href="{{ url_for('main.info') }}" class="btn btn-outline-dark me-3 rounded-pill"><i class="fas fa-info-circle me-1"></i> Info</a>
          <a href="{{ url_for('cart.view_cart') }}" class="text-dark position-relative me-3">
            <i class="fas fa-shopping-cart"></i>
            {% if cart_item_count %}
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              {{ cart_item_count }}
            </span>
            {% endif %}
          </a>
          
          {% if not current_user.is_authenticated %}
            <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary btn-sm me-2 rounded-pill">Login</a>
            <a href="{{ url_for('auth.user_signup') }}" class="btn  btn-sm rounded-pill" style="background-color: #143670; color: #fff">Signup</a>
          {% else %}
            <span class="me-3">Welcome, {{ current_user.full_name }}</span>
            <a class="nav-link me-3" href="{{ url_for('main.purchased_products') }}"><i class="fas fa-box-open me-1"></i> My Orders</a>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger btn-sm rounded-pill">Logout</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-start offcanvas-half" tabindex="-1" id="offcanvasMenu">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Menu</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><a href="{{ url_for('main.info') }}" style="color: #143670;"><i class="fas fa-info-circle me-2"></i>Info</a></li>
      <li class="list-group-item"><a href="{{ url_for('cart.view_cart') }}" style="color: #143670;"><i class="fas fa-shopping-cart me-2"></i>Cart</a></li>
      <li class="list-group-item"><a href="{{ url_for('main.contact') }}" style="color: #143670;"><i class="fas fa-envelope me-2"></i>Contact</a></li>
      <li class="list-group-item"><a href="{{ url_for('main.track_order') }}" style="color: #143670;"><i class="fas fa-shipping-fast me-2"></i>Track Order</a></li>
      
      {% if not current_user.is_authenticated %}
        <li class="list-group-item"><a href="{{ url_for('auth.login') }}" style="color: #143670;"><i class="fas fa-sign-in-alt me-2"></i>Login</a></li>
        <li class="list-group-item"><a href="{{ url_for('auth.user_signup') }}" style="color: #143670;"><i class="fas fa-user-plus me-2"></i>Signup</a></li>
      {% else %}
        <li class="list-group-item disabled"><i class="fas fa-user me-2"></i>Welcome, {{ current_user.username }}</li>
        <li class="list-group-item"><a href="{{ url_for('main.purchased_products') }}" style="color: #143670;"><i class="fas fa-box-open me-2"></i>My Orders</a></li>
        <li class="list-group-item"><a href="{{ url_for('auth.logout') }}" style="color: #143670;"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
      {% endif %}
    </ul>
  </div>
</div>

<!-- Main Content -->
<main>
  {% block content %}{% endblock %}
</main>

<!-- Newsletter (Always visible) -->
<section class="newsletter-section py-4" style="background-color: #ffcc01; color: #143670;">
  <div class="container-fluid d-flex flex-column flex-md-row justify-content-between align-items-center">
    <p class="newsletter-text mb-3 mb-md-0">
      <i class="fas fa-paper-plane me-2"></i>
      Sign up for our newsletter and receive all news and updates including promotions and special offers
    </p>

    <form method="POST" action="{{ url_for('main.subscribe_newsletter') }}" class="newsletter-form d-flex w-100" style="max-width: 400px;">
      <input type="email" name="email" class="form-control rounded-pill me-2" placeholder="Enter your email address" required>
      <button class="btn rounded-pill px-4 fw-bold" type="submit" style="background-color: #143670; color: #fff;">Signup</button>
    </form>
  </div>
</section>

<!-- FOOTER (Always visible) -->
<footer class="footer-section text-light pt-5 pb-4" style="background-color: #143670;">
  <div class="container-fluid">
    <div class="row gy-5" style="row-gap: 1rem !important;">

      <!-- RealMindX Bookshop -->
      <div class="col-lg-3 col-md-6 text-md-start">
        <h5 class="footer-title" style="color: #ffcc01;">RealMindX Bookshop</h5>
        <p>Purchase all your stationeries at wholesale/retail prices. We provide both deliveries to all locations, and pickups.</p>
        <p><strong>Fast Delivery:</strong> within 48 hours</p>
        <p><strong>Open Hours:</strong><br>7am–5pm (Weekdays)<br>10am–2pm (Sat)</p>
      </div>

      <!-- Find It Fast -->
      <div class="col-lg-3 col-md-6 text-md-start">
        <h5 class="footer-title" style="color: #ffcc01;">Quick Links</h5>
        <ul class="list-unstyled">
          {% for cat in categories %}
          <li>
            <a href="{{ url_for('main.search', category=cat.id) }}" class="text-white" style="text-decoration: none;">
              {% if cat.name|length in [3, 5] %}
                {{ cat.name.upper() }}
              {% else %}
                {{ cat.name }}
              {% endif %}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Contact -->
      <div class="col-lg-3 col-md-6 text-md-start" style="line-height: 1.2;">
        <h5 class="footer-title" style="color: #ffcc01; margin-bottom: 0.4rem;">Contact</h5>
        <p style="margin-bottom: 0.2rem;"><i class="fa fa-map-marker-alt me-2"></i> Dome Pillar 2</p>
        <p style="margin-bottom: 0.2rem;"><i class="fa fa-envelope me-2"></i> <a href="mailto:realmindxgh@gmail.com" class="text-white">realmindxgh@gmail.com</a></p>
        <p style="margin-bottom: 0.2rem;"><i class="fa fa-phone me-2"></i> +233 55 803 9190</p>
        <p style="margin-bottom: 0.2rem;"><i class="fa fa-phone me-2"></i> +233 55 452 9493</p>
        <p style="margin-bottom: 0.2rem;"><i class="fa fa-phone me-2"></i> +233 55 132 4729</p>
      </div>
      
      <!-- Customer Care -->
      <div class="col-lg-3 col-md-6 text-md-start">
        <h5 class="footer-title" style="color: #ffcc01;">Customer Care</h5>
        <ul class="list-unstyled">
          <li><a href="{{ url_for('auth.login') }}" class="text-white" style="text-decoration: none;">My Account</a></li>
          <li><a href="{{ url_for('main.purchased_products') if current_user.is_authenticated else url_for('auth.login') }}" class="text-white" style="text-decoration: none;">My Orders</a></li>
          <li><a href="{{ url_for('cart.checkout') }}" class="text-white" style="text-decoration: none;">Checkout</a></li>
          <li><a href="#" class="text-white" style="text-decoration: none;">Terms & Conditions</a></li>
        </ul>
      </div>

      <!-- Follow Us -->
      <div class="col-lg-3 col-md-6 text-md-start">
        <h5 class="footer-title" style="color: #ffcc01;">Follow Us</h5>
        <div class="social-icons mb-3">
          <a href="https://x.com/RealMindXgh" target="_blank" style="text-decoration:none;"> <i class="fa-brands fa-x-twitter" style="color:#000000; font-size:18px;"></i> </a> 
          <a href="https://web.facebook.com/profile.php?id=61566941171883" target="_blank" style="text-decoration:none;"> <i class="fa-brands fa-facebook" style="color:#1877F2; font-size:18px;"></i> </a>
          <a href="https://www.instagram.com/realmindxgh/" target="_blank" style="text-decoration:none;"> <i class="fa-brands fa-instagram" style="color:#E1306C; font-size:18px;"></i> </a>
          <a href="https://www.youtube.com/@realmindxgh" target="_blank" style="text-decoration:none;"> <i class="fa-brands fa-youtube" style="color:#FF0000; font-size:18px;"></i> </a>
          <a href="https://wa.link/d6x888" target="_blank" style="text-decoration:none;"> <i class="fa-brands fa-whatsapp" style="color:#25D366; font-size:18px;"></i> </a>
        </div>
      </div>
      
      <div class="text-center mt-3"> <small id="copyright"></small> </div>
    </div>
  </div>
</footer>

<!-- WhatsApp Float -->
<a href="https://wa.link/q5rjtp" class="whatsapp-float" target="_blank" style="position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  background-color: transparent;
  border-radius: 50%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  transition: transform 0.2s ease-in-out;">
    <img src="{{ url_for('static', filename='images/whatsapp.png') }}" alt="WhatsApp" width="60">
</a>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const year = new Date().getFullYear();
    document.getElementById("copyright").textContent = `© ${year} RealmindX Education. All rights reserved.`;
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- user inactive for 10 minutes -->
<script>
  let inactivityTimer;
  const logoutTime = 10 * 60 * 1000; // 10 minutes

  function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
          alert("You have been logged out due to inactivity.");
          window.location.href = "{{ url_for('auth.logout') }}";
      }, logoutTime);
  }

  // Reset timer on user activity
  window.onload = resetInactivityTimer;
  document.onmousemove = resetInactivityTimer;
  document.onkeypress = resetInactivityTimer;
  document.onclick = resetInactivityTimer;
  document.onscroll = resetInactivityTimer;
</script>
</body>
</html>